define(['require', 'app'], function(require, APP) {

    /**
     * Controller for Screen1 generated by Appery.io
     * @module Screen1
     */

    APP.controller('Screen1', ['$scope', 'Apperyio', controller]);

    function controller($scope, Apperyio) {
        /**
         * User controller functions
         */
        /**
         * @function init
         */
        $scope.init = function() {
            //On load screen logic
        };

        /**
         * @function showLocation
         */
        $scope.showLocation = function() {
            var requestData = {}; /*|button_mapping|onbeforesend|18E20620-0C80-CCDE-ECA1-163C7D62C751||8839|*/

            // read more about using rest services: https://links.appery.io/ve-snippet-rest
            // var i = 0;
            // while(i<5){
            // setTimeout(Apperyio.get("Geolocation_currentPosition")(requestData).then(
            // function(success){ // success callback
            //     (function mapping1002(success, $scope){
            //         var lat_scope = $scope.lat;
            //         var lng_scope = $scope.lng;
            //         // var arr = [$scope.lat, $scope.lng];
            //         lat_scope = success.coords.latitude;
            //         lng_scope = success.coords.longitude;
            //         $scope.lat = lat_scope;
            //         $scope.lng = lng_scope;
            //         $scope.arr = [Number(lat_scope), Number(lng_scope)];
            //         /*CLICK TO EDIT MAPPING*/
            //     })(success, $scope);
            // firebase.database().ref("/user").push({
            // 	//location : "location-21",
            // 	g : "tepg0mv545",
            // 	l : [Number($scope.lat), Number($scope.lng)]

            // });
            // },
            // function(error){ // callback to handle request error
            // },
            // function(notify){ // notify callback, can fire few times
            // }), 3000);
            // i = i+1;
            // }

            (function myLoop(i) {
                setTimeout(function() {

                    Apperyio.get("Geolocation_currentPosition")(requestData).then(

                    function(success) { // success callback
                        (function mapping1002(success, $scope) {
                            var lat_scope = $scope.lat;
                            var lng_scope = $scope.lng;
                            // var arr = [$scope.lat, $scope.lng];
                            lat_scope = success.coords.latitude;
                            lng_scope = success.coords.longitude;
                            $scope.lat = lat_scope;
                            $scope.lng = lng_scope;
                            $scope.arr = [Number(lat_scope), Number(lng_scope)]; /*CLICK TO EDIT MAPPING*/
                        })(success, $scope);

                        firebase.database().ref("/user").push({
                            //location : "location-21",
                            g: "tepg0mv545",
                            l: [Number($scope.lat), Number($scope.lng)]

                        });
                    }, function(error) { // callback to handle request error
                    }, function(notify) { // notify callback, can fire few times
                    }); //  your code here                

                    if (--i) myLoop(i); //  decrement i and call myLoop again if i > 0
                }, 3000)
            })(10);
        };

        /**
         * user controller variables
         */
        $scope.lat = Apperyio.EntityAPI('String');
        $scope.lng = Apperyio.EntityAPI('String');
        $scope.arr = Apperyio.EntityAPI('array');
    }

});